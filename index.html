<!DOCTYPE html>
<html lang="zh-TW" class="h-full bg-white">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>BANANA EATS! ä»Šå¤©åƒä»€éº¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700;900&family=Poppins:wght@700;900&display=swap" rel="stylesheet">
    <script>
        // è¨­å®š Banana é¢¨æ ¼è‰²ç¥¨
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        banana: { DEFAULT: '#FFE135', dark: '#E6C300' },
                        dark: '#1A1A1A'
                    },
                    fontFamily: {
                        sans: ['"Poppins"', '"Noto Sans TC"', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        /* å…¨åŸŸè¨­å®šï¼šç¦æ­¢å½ˆæ€§æ»¾å‹•ï¼Œæ›´åƒ App */
        body { overscroll-behavior: none; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        /* éš±è—æ»¾å‹•æ¢ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* æŒ‡é‡æ¨£å¼ - æ”¹ç‚ºé»‘è‰²å¹¾ä½•é¢¨æ ¼ */
        .pointer {
            width: 0; height: 0; 
            border-left: 16px solid transparent;
            border-right: 16px solid transparent;
            border-top: 32px solid #1A1A1A; 
            position: absolute; top: -15px; left: 50%;
            transform: translateX(-50%); z-index: 20;
            filter: drop-shadow(0 4px 0px rgba(0,0,0,0.2));
        }
        /* è½‰ç›¤é™°å½±èˆ‡é‚Šæ¡†å„ªåŒ– */
        .wheel-container {
            box-shadow: 0 10px 0px #1A1A1A, 0 15px 20px rgba(0,0,0,0.2);
            border: 8px solid #1A1A1A;
        }

        /* ç²å‹å‹•ç•« - å¼·çƒˆçš„é»ƒè‰²é–ƒçˆ */
        @keyframes banana-flash {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 225, 53, 0.8); }
            50% { box-shadow: 0 0 0 30px rgba(255, 225, 53, 0); }
        }
        .winner-effect { animation: banana-flash 0.8s ease-out infinite; }
        
        /* æŒ‰éˆ•é»æ“Šæ•ˆæœ */
        .pop-btn:active { transform: translateY(4px); box-shadow: none !important; }
    </style>
</head>
<body class="h-full w-full flex flex-col text-dark safe-area-padding select-none overflow-hidden">

    <header class="pt-12 pb-4 px-6 flex items-center justify-between bg-white relative z-10">
        <div>
            <h1 class="text-4xl font-black tracking-tighter italic uppercase bg-banana inline-block px-2 transform -rotate-2">Banana Eats!</h1>
            <p class="text-sm font-bold text-gray-500 mt-1 tracking-widest uppercase">Decision Spinner</p>
        </div>
        <div class="w-12 h-12 bg-banana rounded-full border-4 border-dark flex items-center justify-center text-2xl shadow-[2px_2px_0_#1A1A1A]">
            ğŸŒ
        </div>
    </header>

    <main class="flex-1 flex flex-col items-center justify-start px-4 pb-8 space-y-6 overflow-y-auto no-scrollbar">
        
        <div class="w-full">
            <div class="flex overflow-x-auto no-scrollbar gap-2 py-2 px-1" id="presetButtons">
                </div>
        </div>

        <div class="w-full relative group">
             <div class="absolute inset-0 bg-dark translate-x-1 translate-y-1 rounded-2xl"></div>
            <textarea id="inputChoices" rows="2" class="relative w-full px-4 py-4 bg-white rounded-2xl border-4 border-dark focus:outline-none focus:border-banana text-lg font-bold resize-none placeholder-gray-300 shadow-sm transition-all" placeholder="è¼¸å…¥é¸é …...">æ‹‰éºµ, å£½å¸, ç¾©å¤§åˆ©éºµ, éº¥ç•¶å‹, å··å£ä¹¾éºµ</textarea>
        </div>

        <div class="relative mt-4 transform transition-transform duration-300 hover:scale-[1.02]">
            <div class="pointer"></div>
            <div class="relative rounded-full overflow-hidden bg-white wheel-container">
                <canvas id="wheelCanvas" width="320" height="320" class="block"></canvas>
            </div>
        </div>

         <div class="h-24 flex-shrink-0"></div>
    </main>

    <footer class="fixed bottom-0 left-0 w-full p-4 bg-white/80 backdrop-blur-md border-t-4 border-dark z-50 pb-[calc(1rem+env(safe-area-inset-bottom))]">
        <div class="max-w-md mx-auto relative">
             <div class="absolute inset-0 bg-dark translate-x-1 translate-y-1 rounded-2xl"></div>
            <button id="spinBtn" onclick="spin()" class="pop-btn relative w-full py-4 rounded-2xl bg-banana text-dark font-black text-2xl shadow-[4px_4px_0_#1A1A1A] transition-all flex items-center justify-center gap-2 uppercase italic border-4 border-dark tracking-wider hover:bg-banana-dark">
                GO! <span class="text-base font-bold not-italic opacity-80">å¹«æˆ‘é¸</span>
            </button>
        </div>
    </footer>

    <div id="resultContainer" class="fixed inset-0 z-[100] bg-dark/90 backdrop-blur-sm hidden opacity-0 transition-all duration-300 flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-sm p-8 rounded-[2rem] border-8 border-banana text-center shadow-[8px_8px_0_#1A1A1A] relative transform scale-90 transition-all duration-300" id="resultCard">
            <p class="text-xl font-black uppercase bg-banana inline-block px-3 -rotate-2 mb-4 shadow-[2px_2px_0_#1A1A1A]">It's...</p>
            <p class="text-5xl font-black text-dark leading-tight break-words" id="resultText">---</p>
            <div class="mt-8">
                 <div class="inline-block relative">
                     <div class="absolute inset-0 bg-dark translate-x-1 translate-y-1 rounded-xl"></div>
                    <button onclick="closeResult()" class="pop-btn relative px-8 py-3 bg-white border-4 border-dark rounded-xl font-bold text-lg shadow-[2px_2px_0_#1A1A1A] hover:bg-gray-100">OK! å†è½‰ä¸€æ¬¡</button>
                 </div>
            </div>
        </div>
    </div>

    <script>
        // --- è¨­å®šå€ ---
        const menuPresets = {
            "ğŸ² éš¨æ©Ÿå¤§äº‚é¬¥": "random", // å°‡è§¸ç™¼ç¶²è·¯è®€å–
            "ğŸ‡¹ğŸ‡¼ å°å¼": ["æ»·è‚‰é£¯","é›è…¿ä¾¿ç•¶","ç‰›è‚‰éºµ","æ°´é¤ƒ","é¹¹é…¥é›"], 
            "ğŸ‡¯ğŸ‡µ æ—¥å¼": ["æ‹‰éºµ","å£½å¸","ä¸¼é£¯","çƒé¾éºµ"], 
            "ğŸ” é€Ÿé£Ÿ": ["éº¥ç•¶å‹","è‚¯å¾·åŸº","æŠ«è–©","æ¼¢å ¡ç‹"],
            "ğŸ¥— å¥åº·": ["æ²™æ‹‰","å„ªæ ¼","æ³¢å¥‡ç¢—","å¥åº·é¤ç›’"]
        };
        // é€™è£¡ä¸å†éœ€è¦ hardcoded çš„ allFoods äº†ï¼

        // Pop Art é¢¨æ ¼é«˜å°æ¯”é…è‰²
        const colors = ['#FFE135', '#FFFFFF', '#1A1A1A', '#FF4500', '#00CED1', '#FF69B4'];
        // å°æ‡‰çš„æ–‡å­—é¡è‰²ï¼Œç¢ºä¿å¯è®€æ€§
        const textColors = ['#1A1A1A', '#1A1A1A', '#FFE135', '#FFFFFF', '#1A1A1A', '#1A1A1A'];

        // --- æ ¸å¿ƒè®Šæ•¸ ---
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spinBtn');
        const inputChoices = document.getElementById('inputChoices');
        const resultContainer = document.getElementById('resultContainer');
        const resultCard = document.getElementById('resultCard');
        const resultText = document.getElementById('resultText');
        const presetContainer = document.getElementById('presetButtons');
        const wheelContainer = document.querySelector('.wheel-container');

        let choices = [], startAngle = 0, arc = 0, spinTimeout = null;
        let spinAngleStart = 10, spinTime = 0, spinTimeTotal = 0, isSpinning = false;
        let onlineFoodsData = []; // å„²å­˜å¾ç¶²è·¯æŠ“ä¸‹ä¾†çš„è³‡æ–™

        // --- åˆå§‹åŒ– ---
        window.onload = async () => { 
            generatePresetButtons(); 
            updateWheel();
            // ç¶²é è¼‰å…¥æ™‚ï¼Œå·å·åœ¨èƒŒæ™¯å»æŠ“è³‡æ–™
            await fetchOnlineData();
        };
        inputChoices.addEventListener('input', () => { if(!isSpinning) updateWheel(); });

        // --- æ–°åŠŸèƒ½ï¼šå¾ç¶²è·¯è®€å–è³‡æ–™ (é—œéµä¿®æ”¹) ---
        async function fetchOnlineData() {
            try {
                // é€™è£¡çš„ './foods.json' å°±æ˜¯æˆ‘å€‘å‰›å‰›å»ºçš„æª”æ¡ˆ
                const response = await fetch('./foods.json');
                if (!response.ok) throw new Error('è³‡æ–™è®€å–å¤±æ•—');
                onlineFoodsData = await response.json();
                console.log('æˆåŠŸè¼‰å…¥ç¶²è·¯èœå–®:', onlineFoodsData);
            } catch (error) {
                console.error('ç³Ÿç³•ï¼ŒæŠ“ä¸åˆ°è³‡æ–™:', error);
                // å¦‚æœå¤±æ•—çš„å‚™æ¡ˆ
                onlineFoodsData = ["è®€å–å¤±æ•—", "è«‹æª¢æŸ¥ç¶²è·¯", "æˆ–ç¨å¾Œå†è©¦"];
            }
        }

        // --- é‚è¼¯å‡½æ•¸ ---
        function generatePresetButtons() {
            for (const [key, value] of Object.entries(menuPresets)) {
                // åŒ…ä¸€å±¤ div ä¾†åšé™°å½±æ•ˆæœ
                const wrapper = document.createElement('div');
                wrapper.className = "relative group flex-shrink-0";
                wrapper.innerHTML = `<div class="absolute inset-0 bg-dark translate-x-0.5 translate-y-0.5 rounded-full"></div>`;

                const btn = document.createElement('button');
                btn.className = "pop-btn relative px-4 py-2 rounded-full bg-white text-dark text-sm font-bold border-2 border-dark shadow-[1px_1px_0_#1A1A1A] hover:bg-banana hover:border-dark transition-all whitespace-nowrap";
                btn.innerText = key;
                // ä¿®æ”¹é€™è£¡ï¼šå¦‚æœæ˜¯ randomï¼Œå°±å‘¼å«æ–°çš„å‡½æ•¸
                btn.onclick = () => value === "random" ? applyRandomPreset() : applyPreset(value);
                
                wrapper.appendChild(btn);
                presetContainer.appendChild(wrapper);
            }
        }

        // æ‡‰ç”¨æ™®é€šé è¨­
        function applyPreset(value) {
            if (isSpinning) return;
            inputChoices.value = value.join(", ");
            updateWheel();
            flashInput();
        }

        // æ‡‰ç”¨éš¨æ©Ÿé è¨­ (æ–°åŠŸèƒ½)
        function applyRandomPreset() {
            if (isSpinning) return;
            if (onlineFoodsData.length === 0) {
                alert("è³‡æ–™é‚„åœ¨è®€å–ä¸­ï¼Œè«‹ç­‰ä¸€ç§’å†è©¦è©¦ï¼");
                return;
            }
            // å¾ç¶²è·¯æŠ“ä¸‹æ¥çš„è³‡æ–™è£¡éš¨æ©Ÿæ´—ç‰Œï¼ŒæŒ‘ 8 å€‹
            let newChoices = onlineFoodsData.sort(() => 0.5 - Math.random()).slice(0, 8);
            inputChoices.value = newChoices.join(", ");
            updateWheel();
            flashInput();
        }

        function flashInput() {
            inputChoices.parentElement.querySelector('.absolute').classList.add('bg-banana');
             setTimeout(() => {
                inputChoices.parentElement.querySelector('.absolute').classList.remove('bg-banana');
            }, 300);
        }

        function getChoices() { return inputChoices.value.split(/[,ï¼Œ\n]/).map(s=>s.trim()).filter(s=>s.length>0); }
        
        function updateWheel() {
            choices = getChoices(); if(choices.length===0) choices=['è«‹è¼¸å…¥','é¸é …'];
            arc = Math.PI*2/choices.length; drawWheel();
        }

        // --- ç¹ªåœ–å‡½æ•¸ (Banana é¢¨æ ¼å„ªåŒ–) ---
        function drawWheel() {
            if (!canvas.getContext) return;
            const outsideRadius=150, textRadius=110, insideRadius=35;
            ctx.clearRect(0,0,320,320); 
            ctx.lineWidth=4; 
            ctx.font='900 16px "Poppins", "Noto Sans TC"'; // ä½¿ç”¨æ›´ç²—çš„å­—é«”

            for(let i=0; i<choices.length; i++) {
                const angle = startAngle + i*arc;
                const colorIndex = i % colors.length;
                ctx.fillStyle = colors[colorIndex];
                ctx.strokeStyle = "#1A1A1A"; // é»‘è‰²é‚Šæ¡†

                ctx.beginPath(); ctx.arc(160,160,outsideRadius,angle,angle+arc,false);
                ctx.arc(160,160,insideRadius,angle+arc,angle,true);
                ctx.fill(); ctx.stroke();

                ctx.save(); 
                ctx.fillStyle = textColors[colorIndex]; // æ ¹æ“šèƒŒæ™¯è‰²æ±ºå®šæ–‡å­—é¡è‰²
                ctx.translate(160+Math.cos(angle+arc/2)*textRadius, 160+Math.sin(angle+arc/2)*textRadius);
                ctx.rotate(angle+arc/2+Math.PI/2);
                const text = choices[i].length>7 ? choices[i].substring(0,6)+".." : choices[i];
                ctx.fillText(text,-ctx.measureText(text).width/2,4); ctx.restore();
            }
            // ä¸­å¿ƒè£é£¾ - é¦™è•‰é»ƒé…é»‘é‚Š
            ctx.beginPath(); ctx.arc(160,160,insideRadius-5,0,Math.PI*2); 
            ctx.fillStyle="#FFE135"; ctx.strokeStyle="#1A1A1A"; ctx.lineWidth=4; ctx.fill(); ctx.stroke();
            // ä¸­å¿ƒå°ç™½é»
            ctx.beginPath(); ctx.arc(160,160,insideRadius-15,0,Math.PI*2); ctx.fillStyle="#FFFFFF"; ctx.fill();
        }

        // --- æ—‹è½‰é‚è¼¯ ---
        function spin() {
            if(isSpinning) return;
            choices = getChoices(); if(choices.length<2) { alert("è‡³å°‘å…©å€‹é¸é …"); return; }
            isSpinning=true; spinBtn.disabled=true; spinBtn.classList.add('opacity-50', 'scale-95');
            wheelContainer.classList.remove('winner-effect');
            spinAngleStart = Math.random()*10+15; // åŠ å¿«ä¸€é»åˆé€Ÿåº¦
            spinTime=0; spinTimeTotal=Math.random()*1500+3000; // ç¸®çŸ­ä¸€é»ç¸½æ™‚é–“ (3-4.5ç§’)
            rotateWheel();
        }
        function rotateWheel() {
            spinTime += 30;
            if(spinTime >= spinTimeTotal) { stopRotateWheel(); return; }
            const spinAngle = spinAngleStart - (spinAngleStart * Math.sin(spinTime/spinTimeTotal * (Math.PI/2))); 
            startAngle += (spinAngle * Math.PI/180); drawWheel();
            spinTimeout = requestAnimationFrame(rotateWheel);
        }
        function stopRotateWheel() {
            cancelAnimationFrame(spinTimeout);
            const degrees = startAngle*180/Math.PI+90;
            const index = Math.floor((360-degrees%360)/(arc*180/Math.PI));
            showResult(choices[index]);
            isSpinning=false; spinBtn.disabled=false; spinBtn.classList.remove('opacity-50', 'scale-95');
        }
        
        // --- çµæœé¡¯ç¤º (å½ˆçª—å‹•ç•«å„ªåŒ–) ---
        function showResult(text) {
            resultText.innerText = text;
            resultContainer.classList.remove('hidden');
            wheelContainer.classList.add('winner-effect');
            setTimeout(()=> { 
                resultContainer.classList.remove('opacity-0'); 
                resultCard.classList.remove('scale-90');
            },50);
        }
        function closeResult() {
            resultContainer.classList.add('opacity-0');
            resultCard.classList.add('scale-90');
            setTimeout(()=> {
                resultContainer.classList.add('hidden');
                wheelContainer.classList.remove('winner-effect');
            }, 300);
        }
    </script>
</body>
</html>
