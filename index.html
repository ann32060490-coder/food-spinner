<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ä»Šå¤©åƒä»€éº¼">
    
    <title>ä»Šå¤©åƒä»€éº¼ï¼Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f9f6f1; 
            background-image:
                linear-gradient(45deg, #f2ede4 25%, transparent 25%),
                linear-gradient(-45deg, #f2ede4 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #f2ede4 75%),
                linear-gradient(-45deg, transparent 75%, #f2ede4 75%);
            background-size: 60px 60px;
            /* è®“æ‰‹æ©Ÿæ»‘å‹•æ™‚ä¸æœƒæœ‰å½ˆæ€§æ•ˆæœï¼Œæ›´åƒ App */
            overscroll-behavior: none;
            /* é ç•™é ‚éƒ¨ç‹€æ…‹åˆ—ç©ºé–“ï¼Œé¿å…ç€æµ·æ“‹ä½ */
            padding-top: env(safe-area-inset-top);
        }

        .pointer {
            width: 0; height: 0; 
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 24px solid #44403c; 
            position: absolute; top: -10px; left: 50%;
            transform: translateX(-50%); z-index: 10;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
        }

        @keyframes winner-glow {
            0% { box-shadow: 0 0 0 0 rgba(251, 146, 60, 0.5); }
            70% { box-shadow: 0 0 0 25px rgba(251, 146, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(251, 146, 60, 0); }
        }
        .winner-effect { animation: winner-glow 1.5s infinite; }
        
        .tag-btn { transition: all 0.2s ease; }
        .tag-btn:active { transform: scale(0.95); }

        .floating-icon {
            position: absolute; opacity: 0.15; 
            user-select: none; pointer-events: none; z-index: 0;
        }
    </style>
</head>
<body class="h-screen w-screen flex items-center justify-center text-stone-700 overflow-hidden select-none">

    <div class="floating-icon text-6xl top-10 left-5 -rotate-12">ğŸ•</div>
    <div class="floating-icon text-5xl top-32 right-8 rotate-12">ğŸœ</div>
    <div class="floating-icon text-6xl bottom-20 left-10 rotate-6">ğŸ”</div>
    <div class="floating-icon text-5xl bottom-40 right-10 -rotate-12">ğŸ±</div>

    <div class="w-full max-w-md bg-white/95 backdrop-blur-sm rounded-[2rem] shadow-2xl border-2 border-white/70 p-6 flex flex-col items-center relative z-10 mx-4" id="main-card">
        
        <header class="text-center mb-5">
            <div class="inline-flex items-center justify-center w-14 h-14 rounded-full bg-orange-100 mb-2 text-3xl shadow-sm">ğŸ˜‹</div>
            <h1 class="text-2xl font-bold tracking-wide text-stone-800">ä»Šå¤©åƒä»€éº¼ï¼Ÿ</h1>
        </header>

        <div class="w-full mb-5">
            <div class="flex flex-wrap gap-2 justify-center" id="presetButtons"></div>
        </div>

        <div class="w-full mb-6 relative group">
            <textarea id="inputChoices" rows="2" class="w-full px-4 py-3 bg-stone-50 rounded-2xl border-2 border-stone-100 focus:border-orange-300 focus:ring-2 focus:ring-orange-100 outline-none resize-none text-sm text-stone-600 placeholder-stone-400 shadow-inner" placeholder="è¼¸å…¥é¸é …...">æ‹‰éºµ, å£½å¸, ç¾©å¤§åˆ©éºµ, éº¥ç•¶å‹, å··å£ä¹¾éºµ</textarea>
        </div>

        <div class="relative mb-8 transform transition-transform duration-300">
            <div class="pointer"></div>
            <div class="relative rounded-full overflow-hidden shadow-lg border-[6px] border-white bg-stone-100">
                <canvas id="wheelCanvas" width="300" height="300" class="block"></canvas>
            </div>
        </div>

        <div class="w-full space-y-4 text-center relative z-20">
            <button id="spinBtn" onclick="spin()" class="w-full py-4 rounded-2xl bg-gradient-to-br from-stone-700 to-stone-800 text-orange-50 font-bold text-lg shadow-xl active:scale-95 transition-all flex items-center justify-center gap-2 tracking-widest border-b-4 border-stone-900">
                <span class="text-2xl">GO</span> <span class="text-sm opacity-90">å¹«æˆ‘æ±ºå®š</span>
            </button>

            <div id="resultContainer" class="hidden opacity-0 transition-all duration-500 transform translate-y-2 absolute w-full bottom-20 left-0 z-50">
                <div class="p-5 bg-white/95 border-2 border-orange-200 rounded-2xl text-center shadow-2xl backdrop-blur-md mx-4">
                    <p class="text-xs text-orange-500 font-bold uppercase mb-1">å‘½é‹çš„å®‰æ’æ˜¯</p>
                    <p class="text-3xl font-extrabold text-stone-800" id="resultText">---</p>
                    <button onclick="closeResult()" class="mt-3 text-xs text-stone-400 underline">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const menuPresets = {
            "âš¡éš¨æ©Ÿ": "random", "ğŸ‡¹ğŸ‡¼å°å¼": ["æ»·è‚‰é£¯","é›è…¿ä¾¿ç•¶","ç‰›è‚‰éºµ","æ°´é¤ƒ","é¹¹é…¥é›"], 
            "ğŸ‡¯ğŸ‡µæ—¥å¼": ["æ‹‰éºµ","å£½å¸","ä¸¼é£¯","çƒé¾éºµ"], "ğŸ”é€Ÿé£Ÿ": ["éº¥ç•¶å‹","è‚¯å¾·åŸº","æŠ«è–©"],
            "ğŸ¥—å¥åº·": ["æ²™æ‹‰","å„ªæ ¼","æ³¢å¥‡ç¢—"], "ğŸŒ§ï¸ä¸‹é›¨": ["æ³¡éºµ","å¤–é€","æ°´é¤ƒ"]
        };
        const allFoods = ["æ»·è‚‰é£¯","é›è…¿ä¾¿ç•¶","ç‰›è‚‰éºµ","æ°´é¤ƒ","é¹¹é…¥é›","æ‹‰éºµ","å£½å¸","éº¥ç•¶å‹","ç«é‹","ç‡’è‚‰"];
        
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spinBtn');
        const inputChoices = document.getElementById('inputChoices');
        const resultContainer = document.getElementById('resultContainer');
        const resultText = document.getElementById('resultText');
        const mainCard = document.getElementById('main-card');
        const presetContainer = document.getElementById('presetButtons');

        let choices = [], startAngle = 0, arc = 0, spinTimeout = null;
        let spinAngleStart = 10, spinTime = 0, spinTimeTotal = 0, isSpinning = false;
        const colors = ['#A8BCA1', '#D4C4B7', '#B7C4CF', '#E6CBA8', '#CBB2B2', '#A6A2A2', '#94B49F', '#DFD3C3'];

        window.onload = () => { generatePresetButtons(); updateWheel(); };
        inputChoices.addEventListener('input', () => { if(!isSpinning) updateWheel(); });

        function generatePresetButtons() {
            for (const [key, value] of Object.entries(menuPresets)) {
                const btn = document.createElement('button');
                btn.className = "tag-btn px-3 py-2 rounded-xl bg-white text-stone-600 text-xs font-bold border-2 border-stone-100 shadow-sm";
                btn.innerText = key;
                btn.onclick = () => applyPreset(value);
                presetContainer.appendChild(btn);
            }
        }
        function applyPreset(value) {
            if (isSpinning) return;
            let newChoices = (value === "random") ? allFoods.sort(()=>0.5-Math.random()).slice(0,8) : value;
            inputChoices.value = newChoices.join(", ");
            updateWheel();
        }
        function getChoices() { return inputChoices.value.split(/[,ï¼Œ\n]/).map(s=>s.trim()).filter(s=>s.length>0); }
        function updateWheel() {
            choices = getChoices(); if(choices.length===0) choices=['è«‹è¼¸å…¥','é¸é …'];
            arc = Math.PI*2/choices.length; drawWheel();
        }
        function drawWheel() {
            if (!canvas.getContext) return;
            const outsideRadius=140, textRadius=105, insideRadius=25;
            ctx.clearRect(0,0,300,300); ctx.strokeStyle="#ffffff"; ctx.lineWidth=3; ctx.font='bold 14px "Noto Sans TC"';
            for(let i=0; i<choices.length; i++) {
                const angle = startAngle + i*arc;
                ctx.fillStyle = colors[i%colors.length];
                ctx.beginPath(); ctx.arc(150,150,outsideRadius,angle,angle+arc,false);
                ctx.arc(150,150,insideRadius,angle+arc,angle,true);
                ctx.stroke(); ctx.fill();
                ctx.save(); ctx.fillStyle="#44403c";
                ctx.translate(150+Math.cos(angle+arc/2)*textRadius, 150+Math.sin(angle+arc/2)*textRadius);
                ctx.rotate(angle+arc/2+Math.PI/2);
                const text = choices[i].length>6?choices[i].substring(0,5)+"..":choices[i];
                ctx.fillText(text,-ctx.measureText(text).width/2,0); ctx.restore();
            }
            ctx.beginPath(); ctx.arc(150,150,insideRadius-4,0,Math.PI*2); ctx.fillStyle="#fff"; ctx.fill();
        }
        function spin() {
            if(isSpinning) return;
            choices = getChoices(); if(choices.length<2) { alert("è‡³å°‘å…©å€‹é¸é …"); return; }
            isSpinning=true; spinBtn.disabled=true; spinBtn.classList.add('opacity-50');
            resultContainer.classList.add('hidden','opacity-0'); mainCard.classList.remove('winner-effect');
            spinAngleStart = Math.random()*10+10; spinTime=0; spinTimeTotal=Math.random()*2000+4000;
            rotateWheel();
        }
        function rotateWheel() {
            spinTime += 30;
            if(spinTime >= spinTimeTotal) { stopRotateWheel(); return; }
            const spinAngle = spinAngleStart - (spinAngleStart * Math.sin(spinTime/spinTimeTotal * (Math.PI/2))); // EaseOutSine simplified
            startAngle += (spinAngle * Math.PI/180); drawWheel();
            spinTimeout = requestAnimationFrame(rotateWheel);
        }
        function stopRotateWheel() {
            cancelAnimationFrame(spinTimeout);
            const degrees = startAngle*180/Math.PI+90;
            const index = Math.floor((360-degrees%360)/(arc*180/Math.PI));
            showResult(choices[index]);
            isSpinning=false; spinBtn.disabled=false; spinBtn.classList.remove('opacity-50');
        }
        function showResult(text) {
            resultText.innerText = text;
            resultContainer.classList.remove('hidden');
            setTimeout(()=> { resultContainer.classList.remove('opacity-0'); mainCard.classList.add('winner-effect'); },50);
        }
        function closeResult() {
            resultContainer.classList.add('opacity-0');
            setTimeout(()=> resultContainer.classList.add('hidden'), 500);
            mainCard.classList.remove('winner-effect');
        }
    </script>
</body>
</html>
